<div class="grid">
    <div class="col-12">
        <div class="card px-6 py-6">

            <p-toolbar styleClass="mb-4">
                <ng-template pTemplate="left">
                    <div class="my-2">
                        <button pButton pRipple label="REGISTRAR" icon="pi pi-save" class="boton p-button-success mr-2" (click)="agregarInventario()" [disabled]="_perfilAutorizado"></button>
                    </div>
                </ng-template>
            </p-toolbar>


            <ng-container *ngIf="_inventario$ | async as inventario">

                <p-table [value]="inventario" [columns]="columnas"
                    #dt [columns]="columnas" responsiveLayout="scroll" [rows]="10" 
                    [paginator]="true" currentPageReportTemplate="Mostrando de {first} a {last} de {totalRecords} entradas" [rowHover]="true">
                    
                <ng-template pTemplate="caption">
                    <div class="flex flex-column md:flex-row md:justify-content-between md:align-items-center">
                        <h5 class="m-0">Listado de Inventario</h5>
                    </div>
                </ng-template>
    
                    <ng-template pTemplate="header">
                        <tr>
                            <th pSortableColumn="proyecto">Proyecto<p-sortIcon field="proyecto"></p-sortIcon></th>
                            <th pSortableColumn="ubicacionGeografica">Ubicación<p-sortIcon field="ubicacionGeografica"></p-sortIcon></th>
                            <th>Remanente</th>
                            <th>Vendido</th>
                            <th>Acciones</th>
                        </tr>
                    </ng-template>
    
                    <ng-template pTemplate="body" let-item>
                        <tr (click)="traeMovimientosInventario(item.idProyecto)" id="{{item.idProyecto}}">
                            <td style="width:25%; min-width:25rem;">
                                <span class="p-column-title">Proyecto</span>
                                {{item.proyecto}}
                            </td>
                            <td style="width:25%; min-width:25rem;">
                                <span class="p-column-title">Ubicación</span>
                                {{item.ubicacionGeografica}}
                            </td>
                            <td style="width:14%; min-width:10rem;">
                                <span class="p-column-title">Remanente</span>
                                {{item.remanente | number : '0.2-5'}}
                            </td>
                            <td style="width:14%; min-width:10rem;">
                                <span class="p-column-title">Vendidas</span>
                                {{item.vendido | number : '0.2-5'}}
                            </td>
                            <td>
                                <div class="flex">
                                    <button (click)="traeMovimientosInventario(item.idProyecto)" pTooltip="Ver Movimientos" tooltipPosition="top" pButton pRipple icon="pi pi-search" class="boton-redondo p-button-rounded p-button-success mr-2"></button>
                                    <button *ngIf="(!_perfilAutorizado)" (click)="aumentarInventario(item.idInventario)" pTooltip="Aumentar Remanente" tooltipPosition="top" pButton pRipple icon="pi pi-plus-circle" class="boton-editar-aumento boton-redondo p-button-rounded p-button-success mr-2"></button>
                                    <button *ngIf="(!_perfilAutorizado) && validaRemanenteCero(item.remanente)" (click)="disminuirInventario(item.idInventario)" pTooltip="Devolver Remanente" tooltipPosition="top" pButton pRipple icon="pi pi-minus-circle" class="boton-editar boton-redondo p-button-rounded p-button-success mr-2"></button>
                                </div>
                            </td>
                        </tr>
                    </ng-template>
                </p-table>
            </ng-container>

            <ng-container *ngIf="_movimiento$ | async as movimiento">

                <p-table [value]="movimiento" [columns]="columnasMovimiento"
                    #dt [columns]="columnasMovimiento" responsiveLayout="scroll" [rows]="10" 
                    [paginator]="true" currentPageReportTemplate="Mostrando de {first} a {last} de {totalRecords} entradas" [rowHover]="true">
                    
                <ng-template pTemplate="caption">
                    <div class="flex flex-column md:flex-row md:justify-content-between md:align-items-center">
                        <h5 class="m-0">Listado de Movimientos de Inventario en {{proyectoElegido}}</h5>
                    </div>
                </ng-template>
    
                    <ng-template pTemplate="header">
                        <tr>
                            <!-- <th>ID</th> -->
                            <!-- <th>Saldo Inicial</th> -->
                            <!-- <th pSortableColumn="proyecto">Proyecto<p-sortIcon field="proyecto"></p-sortIcon></th> -->
                            <!-- <th>Ubicación</th> -->
                            <th>Movimiento</th>
                            <th pSortableColumn="descripcionMovimiento">Descripción<p-sortIcon field="descripcionMovimiento"></p-sortIcon></th>
                            <th>Fecha</th>
                            <th>Cantidad</th>
                            <th>Remanente</th>
                            <th>Remanente Real</th>
                            <th pSortableColumn="usuario">Usuario<p-sortIcon field="usuario"></p-sortIcon></th>
                            <th>Acciones</th>
                        </tr>
                    </ng-template>
    
                    <ng-template pTemplate="body" let-item>
                        <tr>
                            <!-- <td style="width:3%; min-width:3rem;">
                                <span class="p-column-title">ID</span>
                                {{item.idMovimiento}}
                            </td> -->
                            <!-- <td style="width:7%; min-width:7rem;">
                                <span class="p-column-title">Saldo Inicial</span>
                                {{item.remanenteReal | number : '0.2-5'}}
                            </td> -->
                            <td style="width:5%; min-width:5rem;">
                                <span class="p-column-title">Movimiento</span>
                                {{item.tipoMovimiento}}
                            </td>
                            <td style="width:25%; min-width:25rem;">
                                <span class="p-column-title">Descripción</span>
                                {{item.descripcionMovimiento}}
                            </td>
                            <td style="width:10%; min-width:5rem;">
                                <span class="p-column-title">Fecha</span>
                                {{item.fechaMovimiento | date : 'dd-MM-yyyy HH:mm'}}
                            </td>
                            <!-- <td style="width:10%; min-width:5rem;">
                                <span class="p-column-title">Proyecto</span>
                                {{item.proyecto}}
                            </td> -->
                            <!-- <td style="width:10%; min-width:5rem;">
                                <span class="p-column-title">Ubicación</span>
                                {{item.ubicacionGeografica}}
                            </td> -->
                            <td style="width:7%; min-width:7rem;">
                                <span class="p-column-title">Cantidad</span>
                                {{item.cantidad | number : '0.2-5'}}
                            </td>
                            <td style="width:5%; min-width:5rem;">
                                <span class="p-column-title">Remanente</span>
                                {{item.remanente | number : '0.2-5'}}
                            </td>
                            <td style="width:10%; min-width:10rem;">
                                <span class="p-column-title">Remanente Real</span>
                                {{item.remanenteReal | number : '0.2-5'}}
                            </td>
                            <td style="width:14%; min-width:10rem;">
                                <span class="p-column-title">Usuario</span>
                                {{daFormatoNombre(item.usuario)}}
                            </td>
                            <td *ngIf="item.tipoMovimiento == 'Cotización'">
                                <div class="flex">
                                    <button (click)="irAVerCotizacion(item.descripcionMovimiento)" pButton pRipple icon="pi pi-search" class="boton-redondo p-button-rounded p-button-success mr-2"></button>
                                </div>
                            </td>

                        </tr>
                    </ng-template>
                </p-table>
            </ng-container>

        </div>
    </div>
</div>